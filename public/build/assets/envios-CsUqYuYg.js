document.addEventListener("alpine:init",()=>{Alpine.data("shippingIndex",()=>({methods:[],maxZones:0,currentZones:0,planName:"",isDragging:!1,init(){this.loadInitialData(),this.initializeSortable()},loadInitialData(){const e=document.getElementById("shipping-data");if(e){const t=JSON.parse(e.textContent);this.methods=t.methods||[],this.maxZones=t.maxZones||1,this.currentZones=t.currentZones||0,this.planName=t.planName||""}},initializeSortable(){const e=document.getElementById("shipping-methods-container");e&&"undefined"!=typeof Sortable&&new Sortable(e,{animation:150,handle:".drag-handle",ghostClass:"opacity-50",onStart:()=>{this.isDragging=!0},onEnd:e=>{this.isDragging=!1,this.updateOrder()}})},async toggleMethod(e){try{const t=await fetch(this.getToggleUrl(e),{method:"POST",headers:{"X-CSRF-TOKEN":this.getCsrfToken(),Accept:"application/json"}}),a=await t.json();if(a.success){const t=this.methods.find(t=>t.id===e);t&&(t.is_active=a.is_active),this.showNotification(a.message,"success")}else this.showNotification(a.message||"Error al actualizar método","error")}catch(t){this.showNotification("Error al actualizar método","error")}},async updateOrder(){const e=document.querySelectorAll("[data-method-id]"),t=Array.from(e).map((e,t)=>({id:parseInt(e.dataset.methodId),sort_order:t+1}));try{const e=await fetch(this.getUpdateOrderUrl(),{method:"PUT",headers:{"X-CSRF-TOKEN":this.getCsrfToken(),"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({methods:t})});(await e.json()).success&&this.showNotification("Orden actualizado","success")}catch(a){this.showNotification("Error al actualizar orden","error")}},getCsrfToken(){var e;return(null==(e=document.querySelector('meta[name="csrf-token"]'))?void 0:e.content)||""},getToggleUrl:e=>`/${window.location.pathname.split("/")[1]}/admin/shipping/toggle-active/${e}`,getUpdateOrderUrl:()=>`/${window.location.pathname.split("/")[1]}/admin/shipping/update-order`,showNotification(e,t="success"){},canCreateMoreZones(){return this.currentZones<this.maxZones},getZoneLimitMessage(){return`Zonas de envío: ${this.currentZones}/${this.maxZones} (Plan ${this.planName})`}})),Alpine.data("shippingMethodForm",()=>({method:{name:"",instructions:"",preparation_time:"1h",notification_enabled:!1},init(){this.loadMethodData()},loadMethodData(){const e=document.getElementById("method-data");e&&(this.method=JSON.parse(e.textContent))}})),Alpine.data("shippingZoneForm",()=>({zone:{name:"",description:"",cost:"",free_shipping_from:"",estimated_time:"2-4h",delivery_days:{L:!0,M:!0,X:!0,J:!0,V:!0,S:!0,D:!1},start_time:"09:00",end_time:"18:00",is_active:!0},init(){this.loadZoneData()},loadZoneData(){const e=document.getElementById("zone-data");if(e){const t=JSON.parse(e.textContent);t.id&&(this.zone=t)}},toggleDay(e){this.zone.delivery_days[e]=!this.zone.delivery_days[e]},selectAllDays(){Object.keys(this.zone.delivery_days).forEach(e=>{this.zone.delivery_days[e]=!0})},deselectAllDays(){Object.keys(this.zone.delivery_days).forEach(e=>{this.zone.delivery_days[e]=!1})},selectWeekdays(){this.zone.delivery_days={L:!0,M:!0,X:!0,J:!0,V:!0,S:!1,D:!1}},formatCurrency:e=>e.replace(/\D/g,"").replace(/\B(?=(\d{3})+(?!\d))/g,"."),handleCurrencyInput(e){const t=this.$refs[e],a=t.value.replace(/\D/g,"");t.value=this.formatCurrency(a),this.zone[e]=a},validateTimes(){return!(this.zone.start_time>=this.zone.end_time)||(alert("La hora de inicio debe ser menor que la hora de fin"),!1)},validateDays(){return!!Object.values(this.zone.delivery_days).some(e=>e)||(alert("Debe seleccionar al menos un día de entrega"),!1)},submitForm(){return!(!this.validateTimes()||!this.validateDays())}}))}),window.ShippingUtils={formatPrice:e=>"$"+new Intl.NumberFormat("es-CO").format(e),getMethodIcon:e=>"domicilio"===e?"🚚":"🏪"};

window.ticketsUtils={formatFileSize(t){if(0===t)return"0 Bytes";const e=Math.floor(Math.log(t)/Math.log(1024));return parseFloat((t/Math.pow(1024,e)).toFixed(2))+" "+["Bytes","KB","MB"][e]},validateFile:t=>["image/jpeg","image/jpg","image/png","application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","text/plain"].includes(t.type)&&t.size<=5242880,showNotification(t,e="info"){const i=document.createElement("div");i.className="fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg transition-all duration-300 transform translate-x-full";const s={success:"bg-success-300 text-accent-50",error:"bg-error-300 text-accent-50",warning:"bg-warning-300 text-black-500",info:"bg-info-300 text-accent-50"};i.className+=` ${s[e]||s.info}`,i.textContent=t,document.body.appendChild(i),setTimeout(()=>{i.classList.remove("translate-x-full")},100),setTimeout(()=>{i.classList.add("translate-x-full"),setTimeout(()=>{document.body.removeChild(i)},300)},5e3)}},window.ticketsIndex=function(){return{filters:{status:"",priority:"",category:"",search:""},init(){const t=new URLSearchParams(window.location.search);this.filters.status=t.get("status")||"",this.filters.priority=t.get("priority")||"",this.filters.category=t.get("category")||"",this.filters.search=t.get("search")||""},applyFilters(){const t=new URLSearchParams;Object.keys(this.filters).forEach(e=>{this.filters[e]&&t.set(e,this.filters[e])}),window.location.search=t.toString()},clearFilters(){Object.keys(this.filters).forEach(t=>{this.filters[t]=""}),window.location.search=""}}},window.createTicket=function(){return{selectedFiles:[],isSubmitting:!1,init(){this.$watch("selectedFiles",()=>{this.updateFileInput()})},handleFileSelect(t){const e=Array.from(t.target.files);this.processFiles(e)},handleFileDrop(t){const e=Array.from(t.dataTransfer.files);this.processFiles(e)},processFiles(t){const e=3-this.selectedFiles.length;t.slice(0,e).forEach(t=>{if(window.ticketsUtils.validateFile(t))this.selectedFiles.push(t);else{const e=t.type||"desconocido",i=window.ticketsUtils.formatFileSize(t.size);window.ticketsUtils.showNotification(`Archivo "${t.name}" no válido (${e}, ${i}). Solo se permiten JPG, PNG, PDF, DOC, TXT hasta 5MB.`,"error")}})},removeFile(t){this.selectedFiles.splice(t,1)},updateFileInput(){if(this.$refs.fileInput){const t=new DataTransfer;this.selectedFiles.forEach(e=>t.items.add(e)),this.$refs.fileInput.files=t.files}},formatFileSize:t=>window.ticketsUtils.formatFileSize(t),submitForm(){this.isSubmitting||(this.isSubmitting=!0,setTimeout(()=>{this.isSubmitting=!1},5e3))}}},window.ticketDetail=function(){return{showStatusModal:!1,isUpdatingStatus:!1,async updateStatus(t){var e;if(!this.isUpdatingStatus){this.isUpdatingStatus=!0;try{const i=null==(e=document.querySelector('meta[name="csrf-token"]'))?void 0:e.getAttribute("content");if(!i)throw new Error("CSRF token no encontrado");const s=await fetch(window.location.pathname+"/update-status",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":i,Accept:"application/json"},body:JSON.stringify({status:t})}),o=await s.json();if(!o.success)throw new Error(o.message||"Error al actualizar el estado");window.ticketsUtils.showNotification(o.message,"success"),this.showStatusModal=!1,setTimeout(()=>{window.location.reload()},1e3)}catch(i){window.ticketsUtils.showNotification(i.message||"Error al actualizar el estado","error")}finally{this.isUpdatingStatus=!1}}},scrollToResponse(){const t=document.getElementById("response");t&&t.scrollIntoView({behavior:"smooth",block:"start"})}}},window.ticketResponse=function(){return{message:"",selectedFiles:[],isSubmitting:!1,init(){this.$nextTick(()=>{const t=this.$refs.messageTextarea;t&&t.addEventListener("input",this.autoResize.bind(this))})},autoResize(t){const e=t.target;e.style.height="auto",e.style.height=e.scrollHeight+"px"},handleFileSelect(t){const e=Array.from(t.target.files);this.processFiles(e)},processFiles(t){const e=3-this.selectedFiles.length;t.slice(0,e).forEach(t=>{window.ticketsUtils.validateFile(t)?this.selectedFiles.push(t):window.ticketsUtils.showNotification(`Archivo "${t.name}" no válido. Solo se permiten JPG, PNG, PDF, DOC, TXT hasta 5MB.`,"error")})},removeFile(t){this.selectedFiles.splice(t,1)},formatFileSize:t=>window.ticketsUtils.formatFileSize(t),submitResponse(){!this.isSubmitting&&this.message.trim()&&(this.isSubmitting=!0,setTimeout(()=>{this.isSubmitting=!1},5e3))}}},window.ticketHelpers={previewAttachment(t,e){if(e.startsWith("image/")){const e=document.createElement("div");e.className="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50",e.innerHTML=`\n                <div class="max-w-4xl max-h-4xl p-4">\n                    <img src="${t}" class="max-w-full max-h-full object-contain rounded">\n                    <button class="absolute top-4 right-4 text-accent text-2xl" onclick="this.parentElement.parentElement.remove()">\n                        ×\n                    </button>\n                </div>\n            `,document.body.appendChild(e);const i=t=>{"Escape"===t.key&&(e.remove(),document.removeEventListener("keydown",i))};document.addEventListener("keydown",i),e.addEventListener("click",t=>{t.target===e&&(e.remove(),document.removeEventListener("keydown",i))})}else window.open(t,"_blank")},downloadAttachment(t,e){const i=document.createElement("a");i.href=t,i.download=e,i.target="_blank",document.body.appendChild(i),i.click(),document.body.removeChild(i)}},document.addEventListener("DOMContentLoaded",function(){});

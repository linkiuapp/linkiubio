const e={getCsrfToken(){var e;const t=null==(e=document.querySelector('meta[name="csrf-token"]'))?void 0:e.content;if(!t)throw new Error("CSRF token not found");return t},async apiCall(e,t={}){const i={...{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":this.getCsrfToken()}},...t};try{const t=await fetch(e,i);if(!t.ok)throw new Error(`HTTP ${t.status}: ${t.statusText}`);return await t.json()}catch(n){throw n}},generateSlug:e=>e.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,""),generateRandomSlug:(e="tienda")=>`${e}-${Math.random().toString(36).substring(2,8)}`,debug(...e){window.APP_DEBUG||localStorage.getItem("store_debug")}};window.StoreUtils=e;const t={showNotification:!1,notificationMessage:"",notificationType:"success",showNotificationMessage(e,t="success"){this.notificationMessage=e,this.notificationType=t,this.showNotification=!0,setTimeout(()=>{this.showNotification=!1},5e3)},handleError(e,t="Ha ocurrido un error"){this.showNotificationMessage(t,"error")}};document.addEventListener("alpine:init",()=>{e.debug("Alpine init detected - registering components"),Alpine.data("storeManagement",()=>({selectedStores:[],showDeleteModal:!1,deleteStoreId:null,deleteStoreName:"",...t,init(){e.debug("StoreManagement initialized"),this.$nextTick(()=>{this.initializeComponents()})},initializeComponents(){this.setupCheckboxes(),this.setupVerificationSwitches(),e.debug("All components initialized")},setupCheckboxes(){const t=document.getElementById("selectAll"),i=document.querySelectorAll(".store-checkbox");t&&0!==i.length?(t.addEventListener("change",()=>{this.handleSelectAll(t.checked,i)}),i.forEach(e=>{e.addEventListener("change",()=>{this.handleIndividualCheckbox(e)})}),e.debug(`Checkboxes configured: ${i.length} individual + 1 select-all`)):e.debug("No checkboxes found, skipping setup")},handleSelectAll(e,t){this.selectedStores=[],t.forEach(t=>{t.checked=e,e&&this.selectedStores.push(t.value)}),this.updateBulkActionsUI()},handleIndividualCheckbox(e){e.checked?this.selectedStores.includes(e.value)||this.selectedStores.push(e.value):this.selectedStores=this.selectedStores.filter(t=>t!==e.value),this.updateBulkActionsUI(),this.updateSelectAllState()},updateBulkActionsUI(){const e=document.getElementById("bulkActions"),t=document.getElementById("selectedCount");e&&(e.style.display=this.selectedStores.length>0?"flex":"none"),t&&(t.textContent=this.selectedStores.length)},updateSelectAllState(){const e=document.getElementById("selectAll"),t=document.querySelectorAll(".store-checkbox");if(!e)return;const i=document.querySelectorAll(".store-checkbox:checked").length,n=t.length;e.checked=i===n&&i>0,e.indeterminate=i>0&&i<n},setupVerificationSwitches(){const t=document.querySelectorAll(".verified-toggle");0!==t.length&&(e.debug(`Setting up ${t.length} verified toggles`),t.forEach((e,t)=>{this.configureVerificationToggle(e)}))},configureVerificationToggle(e){e.addEventListener("focus",e=>e.target.blur()),e.addEventListener("change",async e=>{await this.handleVerificationToggle(e)})},async executeBulkAction(){const t=document.getElementById("bulkActionSelect");if(!t)return void this.showNotificationMessage("Elemento de acción no encontrado","error");const i=t.value;if(i)if(0!==this.selectedStores.length){if(confirm(`¿Estás seguro de aplicar esta acción a ${this.selectedStores.length} tienda(s)?`))try{const t=await e.apiCall("/superlinkiu/stores/bulk-action",{method:"POST",body:JSON.stringify({store_ids:this.selectedStores,action:i})});if(!t.success)throw new Error(t.message||"Error al ejecutar la acción");this.showNotificationMessage(t.message,"success"),setTimeout(()=>window.location.reload(),1500)}catch(n){this.handleError(n,"Error al ejecutar la acción bulk")}}else this.showNotificationMessage("Por favor selecciona al menos una tienda","warning");else this.showNotificationMessage("Por favor selecciona una acción","warning")},exportData(e){const t=new URL(window.location.href);t.searchParams.set("export",e),window.location.href=t.toString()},async loginAsStore(t){if(confirm("¿Deseas entrar como administrador de esta tienda?"))try{const i=await e.apiCall(`/superlinkiu/stores/${t}/login-as`,{method:"POST"});if(!i.success)throw new Error(i.message||"Error al iniciar sesión");window.location.href=i.redirect}catch(i){this.handleError(i,"Error al iniciar sesión como tienda")}},openDeleteModal(e,t){this.deleteStoreId=e,this.deleteStoreName=t,this.showDeleteModal=!0},closeDeleteModal(){this.showDeleteModal=!1,this.deleteStoreId=null,this.deleteStoreName=""},async confirmDelete(){if(this.deleteStoreId)try{const t=await e.apiCall(`/superlinkiu/stores/${this.deleteStoreId}`,{method:"DELETE"});if(!1===t.success)throw new Error(t.message||"Error al eliminar la tienda");this.closeDeleteModal(),this.showNotificationMessage("Tienda eliminada exitosamente","success"),setTimeout(()=>window.location.reload(),1500)}catch(t){this.handleError(t,"Error al eliminar la tienda")}}})),Alpine.data("createStore",()=>({selectedPlan:"",slug:"",isXplorer:!1,init(){this.loadOldValues(),e.debug("CreateStore initialized")},loadOldValues(){var e,t;const i=null==(e=document.querySelector('input[name="_old_plan_id"]'))?void 0:e.value,n=null==(t=document.querySelector('input[name="_old_slug"]'))?void 0:t.value;i&&(this.selectedPlan=i,this.checkPlanType()),n&&(this.slug=n)},generateSlug(t){if(this.isXplorer)return;const i=t.target.value;this.slug=e.generateSlug(i)},checkPlanType(){const t=document.querySelector('select[name="plan_id"]');if(!t)return;const i=Array.from(t.options).find(e=>e.value===this.selectedPlan);if(!i)return;const n=i.getAttribute("data-plan-name"),o="true"===i.getAttribute("data-allow-custom");if(this.isXplorer="Explorer"===n,this.isXplorer)this.slug=e.generateRandomSlug();else if(o){const t=document.querySelector('input[name="name"]');(null==t?void 0:t.value)&&(this.slug=e.generateSlug(t.value))}}})),Alpine.data("editStore",()=>({selectedPlan:"",slug:"",originalPlanId:"",originalPlanSlug:"",originalSlug:"",canEditSlug:!1,isUpgrading:!1,init(){this.loadOriginalValues(),this.checkInitialSlugEditability(),e.debug("EditStore initialized")},loadOriginalValues(){const e=e=>{var t;return(null==(t=document.getElementById(e))?void 0:t.value)||""};this.originalPlanId=e("original_plan_id"),this.originalPlanSlug=e("original_plan_slug"),this.originalSlug=e("original_slug"),this.selectedPlan=this.originalPlanId,this.slug=this.originalSlug},checkInitialSlugEditability(){const e=document.querySelector('select[name="plan_id"]');if(!e)return;const t=Array.from(e.options).find(e=>e.value===this.originalPlanId);if(t){const e="true"===t.getAttribute("data-allow-custom");this.canEditSlug=e}},checkPlanChange(){const e=document.querySelector('select[name="plan_id"]');if(!e)return;const t=Array.from(e.options).find(e=>e.value===this.selectedPlan);if(!t)return;const i="true"===t.getAttribute("data-allow-custom"),n=this.isUpgrading;this.canEditSlug=i,this.isUpgrading=this.selectedPlan!==this.originalPlanId&&i,!n&&this.isUpgrading||i||(this.slug=this.originalSlug)}})),e.debug("All Alpine components registered successfully")});

#!/bin/bash

# Laravel Cloud Deploy Script
echo "🚀 Starting Laravel Cloud deployment..."

# Install Composer dependencies
echo "📦 Installing PHP dependencies..."
composer install --no-dev --optimize-autoloader

# Install NPM dependencies
echo "📦 Installing JS dependencies..."
npm ci

# Build assets with Vite (IMPORTANTE: Esto compila con terser)
echo "🔨 Building production assets..."
npm run build

# Run migrations
echo "🗄️  Running migrations..."
php artisan migrate --force

# Clear and cache config
echo "⚡ Optimizing application..."
php artisan config:cache
php artisan route:cache
php artisan view:cache

# Storage link
echo "🔗 Creating storage link..."
php artisan storage:link

echo "✅ Deployment completed successfully!"

